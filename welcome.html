<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Real-time waste monitoring dashboard - Track bin levels and manage waste efficiently">
  <title>Waste Monitoring - EcoBin-X</title>

  <!-- Favicons -->
  <link rel="icon" href="assets/icon.png" sizes="32x32" type="image/png">
  <link rel="icon" href="assets/icon.png" sizes="192x192" type="image/png">
  <link rel="apple-touch-icon" href="assets/icon.png" sizes="180x180">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom Styles -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img src="assets/icon.png" alt="EcoBin-X Icon">
        EcoBin-X
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="serv.html">Services</a></li>
          <li class="nav-item"><a class="nav-link" href="achievements.html">Achievements</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header Slogan -->
  <div class="header">
    <h1>Waste Monitoring</h1>
    <p class="intro">Efficient waste tracking for a cleaner, greener world.</p>
  </div>

  <!-- Background Image Container -->
  <div class="background-image" style="background-image: url('assets/pics.jpg');"></div>

  <!-- Main Content -->
  <div class="container mt-5 mb-5 main-content">
    <div class="row mb-4 justify-content-center">
      <!-- Bin 1 -->
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="dustbin" id="bin1">
          <img src="assets/OIP.jpeg" alt="Smart Bin 1" class="img-fluid" id="bin1Image">
          <h5>Bin 1 - Waste</h5>
          <p id="wetWasteStatus" class="hidden">Wet Waste Fill Level: Loading...</p>
          <p id="dryWasteStatus" class="hidden">Dry Waste Fill Level: Loading...</p>
          <div class="d-flex justify-content-center gap-2 flex-wrap">
            <button class="btn btn-primary"
              onclick="window.location.href='https://www.google.com/maps/place/Computer+science+engineering+block/@12.9078997,80.140074,18.68z/data=!4m14!1m7!3m6!1s0x3a525f27b4f39457:0x183db7d7023ad4a7!2sCivil+Department,+Bharath+university!8m2!3d12.9081029!4d80.1402622!16s%2Fg%2F11fy21b3pg!3m5!1s0x3a525f27b6b2c733:0x294487f583159d43!8m2!3d12.9082301!4d80.1404655!16s%2Fg%2F11f_x3pk0l?entry=ttu&g_ep=EgoyMDI0MTAyOS4wIKXMDSoASAFQAw%3D%3D'">View
              Location</button>
            <button class="btn btn-history" onclick="window.location.href='bin.html?bin=1'">Bin History</button>
          </div>
        </div>
      </div>

      <!-- Bin 2 -->
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="dustbin" id="bin2">
          <img src="assets/OIP.jpeg" alt="Smart Bin 2" class="img-fluid" id="bin2Image">
          <h5>Bin 2 - Empty</h5>
          <h6>Bin is not Installed in Area</h6>
          <div class="d-flex justify-content-center gap-2 flex-wrap">
            <button class="btn btn-primary"
              onclick="window.location.href='https://www.google.com/maps/place/Computer+science+engineering+block/@12.9078997,80.140074,18.68z/data=!4m14!1m7!3m6!1s0x3a525f27b4f39457:0x183db7d7023ad4a7!2sCivil+Department,+Bharath+university!8m2!3d12.9081029!4d80.1402622!16s%2Fg%2F11fy21b3pg!3m5!1s0x3a525f27b6b2c733:0x294487f583159d43!8m2!3d12.9082301!4d80.1404655!16s%2Fg%2F11f_x3pk0l?entry=ttu&g_ep=EgoyMDI0MTAyOS4wIKXMDSoASAFQAw%3D%3D'">View
              Location</button>
            <button class="btn btn-history" onclick="window.location.href='bin.html?bin=2'">Bin History</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>&copy; 2024 EcoBin-X. All rights reserved.</p>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JavaScript to Fetch ThingSpeak Data and Update Bin Status -->
  <script>
    // Your API Key
    const API_KEY = '617P3MT6LMXU1CEM';
    // URL for ThingSpeak channel
    const THINGSPEAK_URL = `https://api.thingspeak.com/channels/2623279/feeds.json?results=1&api_key=${API_KEY}`;

    async function fetchThingSpeakData() {
      try {
        // Fetch the data from the ThingSpeak channel
        let response = await fetch(THINGSPEAK_URL);
        let data = await response.json();

        // Extracting both field values
        const wetWasteLevel = parseFloat(data.feeds[0].field1);
        const dryWasteLevel = parseFloat(data.feeds[0].field2);

        // Update the bin statuses based on fetched data
        updateBinStatus("wetWasteStatus", wetWasteLevel, "Wet Waste", "bin1Image");
        updateBinStatus("dryWasteStatus", dryWasteLevel, "Dry Waste", "bin1Image");

      } catch (error) {
        console.error("Error fetching data from ThingSpeak:", error);
        // Update statuses to indicate data is unavailable
        document.getElementById("wetWasteStatus").textContent = "Wet Waste Fill Level: Data unavailable";
        document.getElementById("dryWasteStatus").textContent = "Dry Waste Fill Level: Data unavailable";
      }
    }

    function updateBinStatus(statusId, level, type, imageId) {
      const wasteStatus = document.getElementById(statusId);
      const binImage = document.getElementById(imageId);

      if (!isNaN(level)) {
        wasteStatus.textContent = `${type} Fill Level: ${level}% (available)`;
        wasteStatus.classList.remove('hidden'); // Show status when data is available

        // Show "available" only if level is below 10%
        if (level < 10) {
          binImage.src = "assets/red_bin.jpg"; // Image indicating bin is full
        } else {
          binImage.src = "assets/OIP.jpeg"; // Normal image
        }
      } else {
        wasteStatus.classList.add('hidden'); // Hide status if data is unavailable
      }
    }

    function redirectToLocation(location) {
      // Redirect to the location for the corresponding bin
      window.location.href = `location.html?bin=${location}`;
    }

    function redirectToHistory(bin) {
      // Redirect to the history page for the corresponding bin
      window.location.href = `history.html?bin=${bin}`;
    }

    // Fetch data every 10 seconds
    setInterval(fetchThingSpeakData, 10000);

    // Initial fetch on page load
    fetchThingSpeakData();
  </script>
</body>

</html>